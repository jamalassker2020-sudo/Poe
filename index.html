<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HFT Forex Scalper</title>
<style>
:root{--bg:#0a0e17;--card:#111827;--accent:#00ff88;--red:#ff4757;--text:#e2e8f0;--dim:#64748b;--gold:#ffd700}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Courier New',monospace;background:var(--bg);color:var(--text);min-height:100vh;font-size:14px}
.hdr{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid #1e293b;background:linear-gradient(90deg,#0f172a,#1e1b4b)}
.logo{color:var(--accent);font-weight:bold;font-size:18px;text-shadow:0 0 10px var(--accent)}
.stats{display:flex;gap:20px;font-size:13px}
.stat span{color:var(--dim)}
.bal{color:var(--gold);font-weight:bold}
.pnl{font-weight:bold}
.ctrl{display:flex;gap:8px;padding:10px 16px;background:#0f172a;border-bottom:1px solid #1e293b;flex-wrap:wrap;align-items:center}
.btn{padding:6px 14px;border:none;border-radius:4px;cursor:pointer;font-family:inherit;font-size:12px;transition:.2s}
.btn-g{background:var(--accent);color:#000}
.btn-r{background:var(--red);color:#fff}
.btn-y{background:#f59e0b;color:#000}
.btn-b{background:#3b82f6;color:#fff}
.btn:hover{opacity:.85;transform:scale(1.02)}
.btn:disabled{opacity:.4;cursor:not-allowed}
.mode{display:flex;gap:4px}
.mode button{background:#1e293b;color:var(--text);border:1px solid #334155}
.mode button.active{background:var(--accent);color:#000;border-color:var(--accent)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:8px;padding:12px;max-height:calc(100vh - 220px);overflow-y:auto}
.pair{background:var(--card);border-radius:6px;padding:10px;border:1px solid #1e293b;transition:.2s;cursor:pointer;position:relative}
.pair:hover{border-color:var(--accent);box-shadow:0 0 12px rgba(0,255,136,.15)}
.pair.long{border-left:3px solid var(--accent)}
.pair.short{border-left:3px solid var(--red)}
.pair-name{font-weight:bold;color:var(--accent);font-size:13px}
.pair-price{font-size:18px;margin:4px 0}
.pair-src{font-size:9px;color:var(--dim)}
.pair-chg{font-size:11px}
.up{color:var(--accent)}
.dn{color:var(--red)}
.pair-sig{position:absolute;top:8px;right:8px;font-size:9px;padding:2px 5px;border-radius:3px}
.sig-buy{background:var(--accent);color:#000}
.sig-sell{background:var(--red);color:#fff}
.sig-wait{background:#475569;color:#fff}
.positions{padding:12px 16px;border-top:1px solid #1e293b;background:#0f172a}
.pos-hdr{display:flex;justify-content:space-between;margin-bottom:8px}
.pos-hdr h3{font-size:13px;color:var(--dim)}
.pos-list{display:flex;flex-wrap:wrap;gap:6px;max-height:100px;overflow-y:auto}
.pos{background:var(--card);padding:6px 10px;border-radius:4px;font-size:11px;display:flex;gap:8px;align-items:center;border:1px solid #334155}
.pos.profit{border-color:var(--accent)}
.pos.loss{border-color:var(--red)}
.pos-pair{font-weight:bold}
.pos-pnl{font-weight:bold}
.ecb{background:#1a1a2e;border:1px solid #334155;border-radius:6px;margin:8px 16px;padding:10px;display:flex;flex-wrap:wrap;gap:15px;font-size:11px}
.ecb-item{display:flex;flex-direction:column}
.ecb-label{color:var(--dim);font-size:9px}
.ecb-val{color:var(--gold);font-weight:bold}
.ecb-live{color:var(--accent);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.log{position:fixed;bottom:8px;left:8px;background:var(--card);padding:8px;border-radius:4px;font-size:10px;max-width:280px;max-height:100px;overflow-y:auto;border:1px solid #334155}
.log-item{padding:2px 0;border-bottom:1px solid #1e293b}
.status{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--card);padding:20px 40px;border-radius:8px;border:1px solid var(--accent);display:none;z-index:100}
@media(max-width:600px){.stats{display:none}.grid{grid-template-columns:repeat(2,1fr)}.ecb{font-size:10px}}
</style>
</head>
<body>
<div class="hdr">
  <div class="logo">‚ö° HFT SCALPER</div>
  <div class="stats">
    <div class="stat"><span>Balance:</span> $<span id="bal" class="bal">10000.00</span></div>
    <div class="stat"><span>Equity:</span> $<span id="eq">10000.00</span></div>
    <div class="stat"><span>P&L:</span> <span id="pnl" class="pnl up">+$0.00</span></div>
    <div class="stat"><span>Positions:</span> <span id="posCnt">0</span>/20</div>
    <div class="stat"><span>Win:</span> <span id="winR" class="up">0%</span></div>
  </div>
</div>
<div class="ecb">
  <div class="ecb-item"><span class="ecb-label">ECB MAIN RATE</span><span class="ecb-val" id="ecbRate">--</span></div>
  <div class="ecb-item"><span class="ecb-label">DEPOSIT RATE</span><span class="ecb-val" id="ecbDepo">--</span></div>
  <div class="ecb-item"><span class="ecb-label">MARGINAL RATE</span><span class="ecb-val" id="ecbMarg">--</span></div>
  <div class="ecb-item"><span class="ecb-label">EUR BIAS</span><span class="ecb-val" id="ecbBias">--</span></div>
  <div class="ecb-item"><span class="ecb-label">FED RATE</span><span class="ecb-val" id="fedRate">--</span></div>
  <div class="ecb-item"><span class="ecb-label">DATA SOURCE</span><span class="ecb-val ecb-live" id="dataSrc">LOADING...</span></div>
  <div class="ecb-item"><span class="ecb-label">LAST UPDATE</span><span class="ecb-val" id="lastUpd">--</span></div>
</div>
<div class="ctrl">
  <button class="btn btn-b" id="fetchBtn">üîÑ FETCH LIVE DATA</button>
  <button class="btn btn-g" id="startBtn" disabled>‚ñ∂ START</button>
  <button class="btn btn-r" id="stopBtn" disabled>‚èπ STOP</button>
  <button class="btn btn-y" id="closeAll">‚úñ CLOSE ALL</button>
  <div class="mode">
    <button class="active" data-m="ultra">ULTRA</button>
    <button data-m="fast">FAST</button>
    <button data-m="normal">NORMAL</button>
  </div>
  <label style="font-size:11px;color:var(--dim);margin-left:auto">
    Risk: <input type="range" id="risk" min="1" max="10" value="3" style="width:60px"> <span id="riskV">3</span>%
  </label>
  <label style="font-size:11px;color:var(--dim)">
    Trail: <input type="number" id="trail" value="15" min="5" max="50" style="width:40px;background:#1e293b;border:1px solid #334155;color:#fff;padding:2px">pip
  </label>
</div>
<div class="grid" id="grid"></div>
<div class="positions">
  <div class="pos-hdr"><h3>üìä ACTIVE POSITIONS</h3><span id="totPnl" class="pnl up">+$0.00</span></div>
  <div class="pos-list" id="posList"></div>
</div>
<div class="status" id="status">‚è≥ Fetching live data...</div>
<div class="log" id="log"></div>
<script>
const PAIRS=['EUR/USD','GBP/USD','USD/JPY','USD/CHF','AUD/USD','NZD/USD','USD/CAD',
'EUR/GBP','EUR/JPY','EUR/CHF','EUR/AUD','EUR/NZD','EUR/CAD',
'GBP/JPY','GBP/CHF','GBP/AUD','GBP/NZD','GBP/CAD',
'AUD/JPY','AUD/NZD','AUD/CHF','AUD/CAD',
'NZD/JPY','NZD/CHF','NZD/CAD','CHF/JPY','CAD/JPY','CAD/CHF','USD/SGD'];

let basePrices={},prices={},momentum={},volatility={},positions=[],balance=10000,wins=0,losses=0;
let running=false,interval=null,mode='ultra',tickCount=0,liveDataLoaded=false;
let ecbData={main:null,depo:null,marg:null,fed:null};
const grid=document.getElementById('grid'),posList=document.getElementById('posList'),log=document.getElementById('log');

// Fetch real ECB rates from ECB Statistical Data Warehouse
async function fetchECBRates(){
  try{
    // ECB Main Refinancing Rate
    const mainRes=await fetch('https://sdw-wsrest.ecb.europa.eu/service/data/FM/D.U2.EUR.4F.KR.MRR_RT.LEV?lastNObservations=1&format=jsondata');
    if(mainRes.ok){const d=await mainRes.json();ecbData.main=parseFloat(d.dataSets[0].series['0:0:0:0:0:0:0'].observations['0'][0])}
    
    // Deposit Facility Rate
    const depoRes=await fetch('https://sdw-wsrest.ecb.europa.eu/service/data/FM/D.U2.EUR.4F.KR.DFR.LEV?lastNObservations=1&format=jsondata');
    if(depoRes.ok){const d=await depoRes.json();ecbData.depo=parseFloat(d.dataSets[0].series['0:0:0:0:0:0:0'].observations['0'][0])}
    
    // Marginal Lending Rate
    const margRes=await fetch('https://sdw-wsrest.ecb.europa.eu/service/data/FM/D.U2.EUR.4F.KR.MLFR.LEV?lastNObservations=1&format=jsondata');
    if(margRes.ok){const d=await margRes.json();ecbData.marg=parseFloat(d.dataSets[0].series['0:0:0:0:0:0:0'].observations['0'][0])}
    
    return true;
  }catch(e){console.log('ECB fetch error:',e);return false}
}

// Fetch Fed Funds Rate from FRED
async function fetchFedRate(){
  try{
    const res=await fetch('https://api.stlouisfed.org/fred/series/observations?series_id=FEDFUNDS&api_key=0e6b0a22c9efe7e61c14d7c6c0b0c5d0&file_type=json&sort_order=desc&limit=1');
    if(res.ok){const d=await res.json();ecbData.fed=parseFloat(d.observations[0].value)}
    return true;
  }catch(e){return false}
}

// Fetch real forex rates from Frankfurter (uses ECB data)
async function fetchForexRates(){
  try{
    const bases=['EUR','USD','GBP','AUD','NZD','CHF','CAD','JPY','SGD'];
    const symbols='USD,EUR,GBP,JPY,CHF,AUD,NZD,CAD,SGD';
    
    // Fetch from multiple bases to calculate crosses
    const rates={};
    for(const base of ['EUR','USD','GBP']){
      const res=await fetch(`https://api.frankfurter.app/latest?from=${base}&to=${symbols}`);
      if(res.ok){const d=await res.json();rates[base]=d.rates;rates[base][base]=1}
    }
    
    // Calculate all pairs
    PAIRS.forEach(pair=>{
      const[b,q]=pair.split('/');
      let price=null;
      
      if(rates.EUR&&rates.EUR[b]&&rates.EUR[q]){
        price=rates.EUR[q]/rates.EUR[b];
      }else if(rates.USD&&rates.USD[b]&&rates.USD[q]){
        price=rates.USD[q]/rates.USD[b];
      }else if(rates.GBP&&rates.GBP[b]&&rates.GBP[q]){
        price=rates.GBP[q]/rates.GBP[b];
      }
      
      if(price){basePrices[pair]=price;prices[pair]=price}
    });
    
    return Object.keys(basePrices).length>0;
  }catch(e){console.log('Forex fetch error:',e);return false}
}

// Alternative: Fetch from ExchangeRate API
async function fetchForexRatesAlt(){
  try{
    const res=await fetch('https://open.er-api.com/v6/latest/USD');
    if(!res.ok)return false;
    const d=await res.json();
    const r=d.rates;r.USD=1;
    
    PAIRS.forEach(pair=>{
      const[b,q]=pair.split('/');
      if(r[b]&&r[q]){basePrices[pair]=r[q]/r[b];prices[pair]=r[q]/r[b]}
    });
    return true;
  }catch(e){return false}
}

async function fetchAllData(){
  document.getElementById('status').style.display='block';
  document.getElementById('dataSrc').textContent='FETCHING...';
  addLog('üì° Fetching live market data...','up');
  
  let forexOk=await fetchForexRates();
  if(!forexOk){addLog('‚ö†Ô∏è Trying alternate forex source...','dn');forexOk=await fetchForexRatesAlt()}
  
  const ecbOk=await fetchECBRates();
  await fetchFedRate();
  
  document.getElementById('status').style.display='none';
  
  if(ecbData.main)document.getElementById('ecbRate').textContent=ecbData.main.toFixed(2)+'%';
  if(ecbData.depo)document.getElementById('ecbDepo').textContent=ecbData.depo.toFixed(2)+'%';
  if(ecbData.marg)document.getElementById('ecbMarg').textContent=ecbData.marg.toFixed(2)+'%';
  if(ecbData.fed)document.getElementById('fedRate').textContent=ecbData.fed.toFixed(2)+'%';
  
  // Calculate EUR bias from rate differential
  if(ecbData.main&&ecbData.fed){
    const diff=ecbData.main-ecbData.fed;
    document.getElementById('ecbBias').textContent=diff>0.5?'HAWKISH':diff<-0.5?'DOVISH':'NEUTRAL';
    document.getElementById('ecbBias').style.color=diff>0?'var(--accent)':diff<0?'var(--red)':'var(--gold)';
  }
  
  document.getElementById('dataSrc').textContent=forexOk?(ecbOk?'ECB + FRANKFURTER':'FRANKFURTER'):'SIMULATED';
  document.getElementById('lastUpd').textContent=new Date().toLocaleTimeString();
  
  if(forexOk){
    liveDataLoaded=true;
    document.getElementById('startBtn').disabled=false;
    PAIRS.forEach(p=>{momentum[p]=0;volatility[p]=Math.random()*0.5+0.5});
    renderPairs();
    addLog(`‚úÖ Loaded ${Object.keys(basePrices).length} pairs from live data`,'up');
    if(ecbOk)addLog(`‚úÖ ECB rates loaded: Main ${ecbData.main}%`,'up');
  }else{
    addLog('‚ùå Could not fetch live data - using simulation','dn');
    initSimulated();
  }
}

function initSimulated(){
  const sim={'EUR/USD':1.085,'GBP/USD':1.265,'USD/JPY':154.5,'USD/CHF':0.882,'AUD/USD':0.652,
    'NZD/USD':0.598,'USD/CAD':1.358,'EUR/GBP':0.858,'EUR/JPY':167.6,'EUR/CHF':0.957,
    'EUR/AUD':1.664,'EUR/NZD':1.815,'EUR/CAD':1.473,'GBP/JPY':195.4,'GBP/CHF':1.116,
    'GBP/AUD':1.94,'GBP/NZD':2.116,'GBP/CAD':1.717,'AUD/JPY':100.7,'AUD/NZD':1.091,
    'AUD/CHF':0.575,'AUD/CAD':0.886,'NZD/JPY':92.35,'NZD/CHF':0.528,'NZD/CAD':0.812,
    'CHF/JPY':175.15,'CAD/JPY':113.75,'CAD/CHF':0.65,'USD/SGD':1.342};
  PAIRS.forEach(p=>{basePrices[p]=sim[p]||1;prices[p]=basePrices[p];momentum[p]=0;volatility[p]=Math.random()*0.5+0.5});
  liveDataLoaded=true;
  document.getElementById('startBtn').disabled=false;
  renderPairs();
}

function pip(pair){return pair.includes('JPY')?0.01:0.0001}

function calcSignal(pair){
  const m=momentum[pair],v=volatility[pair];
  const rsi=50+m*30+Math.random()*10-5;
  const macd=m*0.8+Math.random()*0.4-0.2;
  const bb=Math.random()>0.5?1:-1;
  const vol=v>0.7?1.2:1;
  
  // Use real ECB/Fed differential for EUR bias
  let eurBoost=0;
  if(pair.startsWith('EUR')&&ecbData.main&&ecbData.fed){
    const diff=ecbData.main-ecbData.fed;
    eurBoost=diff>0?0.3:diff<0?-0.3:0;
  }
  
  const score=(rsi>60?1:rsi<40?-1:0)+(macd>0.2?1:macd<-0.2?-1:0)+bb*0.5+eurBoost;
  const str=Math.abs(score)*vol;
  if(str>1.5)return score>0?'BUY':'SELL';
  return 'WAIT';
}

function updatePrices(){
  tickCount++;
  PAIRS.forEach(p=>{
    if(!prices[p])return;
    const v=volatility[p]*(mode==='ultra'?2:mode==='fast'?1.2:0.6);
    const trend=momentum[p]*0.7+Math.random()*0.6-0.3;
    momentum[p]=Math.max(-1,Math.min(1,momentum[p]*0.95+trend*0.05));
    const move=(Math.random()-0.5)*pip(p)*v*3;
    prices[p]=Math.max(0.001,prices[p]+move+momentum[p]*pip(p)*0.5);
  });
}

function renderPairs(){
  grid.innerHTML=PAIRS.map(p=>{
    const pr=prices[p]||0,base=basePrices[p]||pr,chg=base?((pr-base)/base*100):0;
    const sig=calcSignal(p);
    const hasPos=positions.find(x=>x.pair===p);
    const cls=hasPos?(hasPos.type==='LONG'?'long':'short'):'';
    const isJpy=p.includes('JPY');
    return`<div class="pair ${cls}" data-p="${p}">
      <div class="pair-name">${p}</div>
      <div class="pair-price">${pr.toFixed(isJpy?3:5)}</div>
      <div class="pair-src">${liveDataLoaded?'LIVE':'SIM'}</div>
      <div class="pair-chg ${chg>=0?'up':'dn'}">${chg>=0?'+':''}${chg.toFixed(3)}%</div>
      <div class="pair-sig sig-${sig.toLowerCase()}">${sig}</div>
    </div>`}).join('');
}

function openPosition(pair,type){
  if(positions.length>=20||positions.find(x=>x.pair===pair))return;
  const risk=parseInt(document.getElementById('risk').value)/100;
  const size=balance*risk/100;
  const entry=prices[pair];
  const trail=parseInt(document.getElementById('trail').value)*pip(pair);
  positions.push({pair,type,entry,size,trail,sl:type==='LONG'?entry-trail:entry+trail,best:entry,locked:false,id:Date.now()});
  addLog(`üìà ${type} ${pair} @ ${entry.toFixed(5)}`,'up');
}

function updatePositions(){
  let totalPnl=0;
  positions.forEach(pos=>{
    const cur=prices[pos.pair];
    const pnl=pos.type==='LONG'?(cur-pos.entry)*pos.size/pip(pos.pair):(pos.entry-cur)*pos.size/pip(pos.pair);
    pos.pnl=pnl;
    totalPnl+=pnl;
    if(pos.type==='LONG'){
      if(cur>pos.best){pos.best=cur;pos.sl=Math.max(pos.sl,cur-pos.trail)}
      if(pnl>pos.size*0.5&&!pos.locked){pos.sl=pos.entry;pos.locked=true;addLog(`üîí LOCKED ${pos.pair}`,'up')}
      if(cur<=pos.sl)closePosition(pos,'SL');
      else if(pnl>pos.size*2)closePosition(pos,'TP');
    }else{
      if(cur<pos.best){pos.best=cur;pos.sl=Math.min(pos.sl,cur+pos.trail)}
      if(pnl>pos.size*0.5&&!pos.locked){pos.sl=pos.entry;pos.locked=true;addLog(`üîí LOCKED ${pos.pair}`,'up')}
      if(cur>=pos.sl)closePosition(pos,'SL');
      else if(pnl>pos.size*2)closePosition(pos,'TP');
    }
  });
  renderPositions();
  const eq=balance+totalPnl;
  document.getElementById('eq').textContent=eq.toFixed(2);
  document.getElementById('totPnl').textContent=(totalPnl>=0?'+$':'-$')+Math.abs(totalPnl).toFixed(2);
  document.getElementById('totPnl').className='pnl '+(totalPnl>=0?'up':'dn');
  document.getElementById('posCnt').textContent=positions.length;
  if(eq<balance*0.7){stopTrading();addLog('üõ°Ô∏è SHIELD ACTIVATED - 30% DD','dn')}
}

function closePosition(pos,reason){
  balance+=pos.pnl;
  if(pos.pnl>0)wins++;else losses++;
  positions=positions.filter(x=>x.id!==pos.id);
  addLog(`${pos.pnl>0?'‚úÖ':'‚ùå'} CLOSE ${pos.pair} ${reason} ${pos.pnl>0?'+':''}$${pos.pnl.toFixed(2)}`,pos.pnl>0?'up':'dn');
  updateStats();
}

function renderPositions(){
  posList.innerHTML=positions.map(p=>`<div class="pos ${p.pnl>0?'profit':'loss'}">
    <span class="pos-pair">${p.pair}</span><span>${p.type}</span>
    <span class="pos-pnl ${p.pnl>=0?'up':'dn'}">${p.pnl>=0?'+':''}$${p.pnl.toFixed(2)}</span>${p.locked?'üîí':''}
  </div>`).join('')||'<span style="color:var(--dim)">No open positions</span>';
}

function updateStats(){
  document.getElementById('bal').textContent=balance.toFixed(2);
  document.getElementById('pnl').textContent=(balance>=10000?'+$':'-$')+Math.abs(balance-10000).toFixed(2);
  document.getElementById('pnl').className='pnl '+(balance>=10000?'up':'dn');
  document.getElementById('winR').textContent=(wins+losses>0?(wins/(wins+losses)*100).toFixed(0):0)+'%';
}

function autoTrade(){
  if(!running||positions.length>=20)return;
  PAIRS.forEach(p=>{
    if(positions.find(x=>x.pair===p)||!prices[p])return;
    const sig=calcSignal(p);
    if(sig==='BUY'&&Math.random()>0.7)openPosition(p,'LONG');
    else if(sig==='SELL'&&Math.random()>0.7)openPosition(p,'SHORT');
  });
}

function tick(){updatePrices();renderPairs();updatePositions();if(running&&tickCount%3===0)autoTrade()}

function startTrading(){
  running=true;
  document.getElementById('startBtn').disabled=true;
  document.getElementById('stopBtn').disabled=false;
  interval=setInterval(tick,mode==='ultra'?100:mode==='fast'?300:600);
  addLog('üöÄ TRADING STARTED','up');
}

function stopTrading(){
  running=false;
  document.getElementById('startBtn').disabled=false;
  document.getElementById('stopBtn').disabled=true;
  clearInterval(interval);
  addLog('‚è∏Ô∏è TRADING PAUSED','dn');
}

function addLog(msg,cls){
  const d=new Date().toLocaleTimeString();
  log.innerHTML=`<div class="log-item ${cls}">[${d}] ${msg}</div>`+log.innerHTML;
  if(log.children.length>20)log.lastChild.remove();
}

document.getElementById('fetchBtn').onclick=fetchAllData;
document.getElementById('startBtn').onclick=startTrading;
document.getElementById('stopBtn').onclick=stopTrading;
document.getElementById('closeAll').onclick=()=>{positions.slice().forEach(p=>closePosition(p,'MANUAL'))};
document.getElementById('risk').oninput=e=>document.getElementById('riskV').textContent=e.target.value;
document.querySelectorAll('.mode button').forEach(b=>b.onclick=e=>{
  document.querySelectorAll('.mode button').forEach(x=>x.classList.remove('active'));
  e.target.classList.add('active');mode=e.target.dataset.m;
  if(running){stopTrading();startTrading()}
});
grid.onclick=e=>{
  const pair=e.target.closest('.pair')?.dataset.p;
  if(!pair||!running)return;
  const sig=calcSignal(pair);
  if(sig==='BUY')openPosition(pair,'LONG');
  else if(sig==='SELL')openPosition(pair,'SHORT');
};

if(matchMedia('(prefers-color-scheme:dark)').matches)document.documentElement.classList.add('dark');
addLog('‚ö° SYSTEM READY - Click FETCH LIVE DATA','up');
</script>
</body>
</html>
