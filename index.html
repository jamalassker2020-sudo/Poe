
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ML Crypto Bot - Real Binance Data</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root { --neon-green: #00ff88; --neon-red: #ff3366; --neon-blue: #00d4ff; --bg-dark: #050508; }
    * { font-family: 'JetBrains Mono', monospace; }
    .title-font { font-family: 'Orbitron', sans-serif; }
    body { background: #050508; color: white; }
    .card { background: #0c0c12; border: 1px solid rgba(0,212,255,0.1); border-radius: 12px; }
    .glow-blue { text-shadow: 0 0 15px var(--neon-blue); }
    .pulse-dot { animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    .z-score-indicator { position: relative; height: 12px; background: #222; border-radius: 6px; overflow: hidden; }
    .z-marker { position: absolute; width: 4px; height: 100%; background: var(--neon-blue); transition: left 0.3s ease; }
    .signal-long { border-left: 3px solid var(--neon-green); background: rgba(0,255,136,0.05); }
    .signal-short { border-left: 3px solid var(--neon-red); background: rgba(255,51,102,0.05); }
  </style>
</head>
<body class="p-4">
  <header class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
    <div class="flex items-center gap-4">
      <div class="text-3xl">ü§ñ</div>
      <div>
        <h1 class="text-2xl font-bold title-font glow-blue">BINANCE ML-LIVE</h1>
        <div class="flex gap-2 text-[10px] mt-1">
          <span class="bg-blue-500/20 px-2 py-0.5 rounded text-blue-400 border border-blue-500/30">REAL-TIME DATA</span>
          <span class="bg-purple-500/20 px-2 py-0.5 rounded text-purple-400 border border-purple-500/30">Z-SCORE ENGINE</span>
        </div>
      </div>
    </div>
    <div class="flex items-center gap-4">
      <div class="text-right">
        <div class="flex items-center justify-end gap-2">
          <span id="statusDot" class="w-2 h-2 rounded-full bg-gray-500 pulse-dot"></span>
          <span id="status" class="text-xs text-gray-400">CONNECTING...</span>
        </div>
        <div id="apiTimer" class="text-[10px] text-gray-600">Syncing Binance API...</div>
      </div>
      <button onclick="toggleBot()" id="botToggle" class="bg-green-500 hover:bg-green-600 text-black font-bold py-2 px-6 rounded-lg transition-all">START BOT</button>
    </div>
  </header>

  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <div class="card p-4 text-center">
      <p class="text-gray-500 text-[10px] uppercase">Equity (Paper)</p>
      <p id="balance" class="text-xl font-bold">$100.00</p>
    </div>
    <div class="card p-4 text-center">
      <p class="text-gray-500 text-[10px] uppercase">Active Trades</p>
      <p id="openPositions" class="text-xl font-bold text-blue-400">0</p>
    </div>
    <div class="card p-4 text-center">
      <p class="text-gray-500 text-[10px] uppercase">Realized PnL</p>
      <p id="pnl" class="text-xl font-bold text-gray-400">$0.00</p>
    </div>
    <div class="card p-4 text-center">
      <p class="text-gray-500 text-[10px] uppercase">Win Rate</p>
      <p id="winRate" class="text-xl font-bold text-purple-400">0%</p>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 card p-4">
      <h2 class="text-xs font-bold mb-4 flex justify-between uppercase">
        <span>Market Analysis (Top 20)</span>
        <span class="text-gray-500" id="lastUpdate">--</span>
      </h2>
      <div class="overflow-x-auto">
        <table class="w-full text-[11px]">
          <thead>
            <tr class="text-gray-500 border-b border-gray-800 text-left">
              <th class="pb-2">Symbol</th>
              <th class="pb-2">Price</th>
              <th class="pb-2">Z-Score (Volatility)</th>
              <th class="pb-2">RSI</th>
              <th class="pb-2 text-right">Action</th>
            </tr>
          </thead>
          <tbody id="marketTable" class="divide-y divide-gray-800/50">
            </tbody>
        </table>
      </div>
    </div>

    <div class="space-y-4">
      <div class="card p-4 h-64 overflow-y-auto">
        <h2 class="text-xs font-bold mb-3 uppercase">Active Positions</h2>
        <div id="positionsList" class="space-y-2"></div>
      </div>
      <div class="card p-4 h-64 overflow-y-auto">
        <h2 class="text-xs font-bold mb-3 uppercase">Trade History</h2>
        <div id="tradeHistory" class="space-y-1 text-[10px]"></div>
      </div>
    </div>
  </div>

  <div class="card mt-6 p-4">
    <canvas id="equityChart" height="150"></canvas>
  </div>

  <script>
    const CONFIG = {
      symbols: ['BTCUSDT','ETHUSDT','SOLUSDT','BNBUSDT','XRPUSDT','ADAUSDT','DOGEUSDT','AVAXUSDT','DOTUSDT','LINKUSDT','MATICUSDT','SHIBUSDT','LTCUSDT','UNIUSDT','NEARUSDT','APTUSDT','ARBUSDT','ATOMUSDT','XLMUSDT','ETCUSDT'],
      lookback: 30, // Minutes
      zThreshold: 2.0,
      rsiLow: 30,
      rsiHigh: 70,
      tp: 0.008, // 0.8%
      sl: 0.005, // 0.5%
      riskPerTrade: 10 // $10 per position
    };

    let state = {
      isRunning: false,
      balance: 100,
      realizedPnL: 0,
      positions: [],
      history: [],
      market: {},
      equityData: []
    };

    // Initialize market object
    CONFIG.symbols.forEach(s => state.market[s] = { prices: [], rsi: 50, zScore: 0, current: 0 });

    const chart = new Chart(document.getElementById('equityChart'), {
      type: 'line',
      data: { labels: [], datasets: [{ label: 'Equity', data: [], borderColor: '#00d4ff', tension: 0.3, fill: true, backgroundColor: 'rgba(0,212,255,0.05)' }] },
      options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { grid: { color: '#111' } } } }
    });

    async function updateMarketData() {
      try {
        // Fetch current prices
        const priceRes = await fetch('https://api.binance.com/api/v3/ticker/price');
        const prices = await priceRes.json();
        
        const updates = CONFIG.symbols.map(async (symbol) => {
          const pData = prices.find(p => p.symbol === symbol);
          if (!pData) return;

          state.market[symbol].current = parseFloat(pData.price);

          // Get candle data for indicators
          const candleRes = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1m&limit=${CONFIG.lookback}`);
          const candles = await candleRes.json();
          const closes = candles.map(c => parseFloat(c[4]));

          // Z-Score calculation
          const mean = closes.reduce((a, b) => a + b) / closes.length;
          const stdDev = Math.sqrt(closes.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / closes.length);
          state.market[symbol].zScore = (state.market[symbol].current - mean) / stdDev;

          // Simple RSI calculation
          let ups = 0, downs = 0;
          for (let i = 1; i < closes.length; i++) {
            const diff = closes[i] - closes[i - 1];
            diff > 0 ? ups += diff : downs -= diff;
          }
          const rs = ups / (downs || 1);
          state.market[symbol].rsi = 100 - (100 / (1 + rs));
        });

        await Promise.all(updates);
        document.getElementById('status').innerText = "BINANCE LIVE";
        document.getElementById('statusDot').style.background = "var(--neon-green)";
        document.getElementById('lastUpdate').innerText = new Date().toLocaleTimeString();
      } catch (e) {
        console.error("API Error", e);
        document.getElementById('status').innerText = "API ERROR";
      }
    }

    function logic() {
      if (!state.isRunning) return;

      CONFIG.symbols.forEach(symbol => {
        const data = state.market[symbol];
        const hasPos = state.positions.find(p => p.symbol === symbol);

        if (!hasPos && state.positions.length < 5) {
          // Entry Logic: Reversion
          if (data.zScore < -CONFIG.zThreshold && data.rsi < CONFIG.rsiLow) {
            openPosition(symbol, 'LONG', data.current);
          } else if (data.zScore > CONFIG.zThreshold && data.rsi > CONFIG.rsiHigh) {
            openPosition(symbol, 'SHORT', data.current);
          }
        }
      });

      // Exit Logic
      state.positions.forEach((pos, idx) => {
        const currentPrice = state.market[pos.symbol].current;
        const pnlPct = pos.type === 'LONG' 
          ? (currentPrice - pos.entry) / pos.entry 
          : (pos.entry - currentPrice) / pos.entry;

        if (pnlPct >= CONFIG.tp || pnlPct <= -CONFIG.sl) {
          closePosition(idx, currentPrice, pnlPct);
        }
      });

      render();
    }

    function openPosition(symbol, type, price) {
      state.positions.push({ symbol, type, entry: price, time: Date.now() });
    }

    function closePosition(index, price, pnlPct) {
      const pos = state.positions[index];
      const profit = CONFIG.riskPerTrade * pnlPct;
      state.realizedPnL += profit;
      state.history.push({ ...pos, exit: price, pnl: profit });
      state.positions.splice(index, 1);
    }

    function toggleBot() {
      state.isRunning = !state.isRunning;
      const btn = document.getElementById('botToggle');
      btn.innerText = state.isRunning ? "STOP BOT" : "START BOT";
      btn.className = state.isRunning ? "bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg" : "bg-green-500 hover:bg-green-600 text-black font-bold py-2 px-6 rounded-lg";
    }

    function render() {
      // Stats
      document.getElementById('balance').innerText = `$${(state.balance + state.realizedPnL).toFixed(2)}`;
      document.getElementById('openPositions').innerText = state.positions.length;
      document.getElementById('pnl').innerText = `${state.realizedPnL >= 0 ? '+' : ''}$${state.realizedPnL.toFixed(2)}`;
      document.getElementById('pnl').className = `text-xl font-bold ${state.realizedPnL >= 0 ? 'text-green-400' : 'text-red-400'}`;

      // Table
      let html = '';
      CONFIG.symbols.forEach(s => {
        const m = state.market[s];
        const zLeft = Math.min(Math.max(50 + (m.zScore * 20), 5), 95);
        html += `<tr>
          <td class="py-2 font-bold">${s.replace('USDT','')}</td>
          <td>$${m.current.toLocaleString()}</td>
          <td class="pr-4"><div class="z-score-indicator"><div class="z-marker" style="left:${zLeft}%"></div></div></td>
          <td class="${m.rsi < 35 ? 'text-green-400' : m.rsi > 65 ? 'text-red-400' : ''}">${m.rsi.toFixed(0)}</td>
          <td class="text-right">${m.zScore < -2 ? 'üî• BUY' : m.zScore > 2 ? '‚ùÑÔ∏è SELL' : 'WAIT'}</td>
        </tr>`;
      });
      document.getElementById('marketTable').innerHTML = html;

      // Positions
      document.getElementById('positionsList').innerHTML = state.positions.map(p => `
        <div class="p-2 rounded text-[10px] ${p.type === 'LONG' ? 'signal-long' : 'signal-short'} flex justify-between">
          <span>${p.symbol} (${p.type})</span>
          <span>Entry: $${p.entry}</span>
        </div>
      `).join('') || '<p class="text-center text-gray-600 text-xs py-4">Scanning for entries...</p>';

      // History
      document.getElementById('tradeHistory').innerHTML = state.history.slice(-5).reverse().map(h => `
        <div class="flex justify-between border-b border-gray-800 pb-1">
          <span>${h.symbol}</span>
          <span class="${h.pnl >= 0 ? 'text-green-400' : 'text-red-400'}">${h.pnl >= 0 ? '+' : ''}$${h.pnl.toFixed(2)}</span>
        </div>
      `).join('');

      // Chart
      state.equityData.push(state.balance + state.realizedPnL);
      if(state.equityData.length > 50) state.equityData.shift();
      chart.data.labels = state.equityData.map((_,i) => i);
      chart.data.datasets[0].data = state.equityData;
      chart.update('none');
    }

    // Main Loops
    setInterval(updateMarketData, 3000); // Fetch Binance data every 3s
    setInterval(logic, 1000); // Run trade logic every 1s
    updateMarketData(); 
  </script>
</body>
</html>

