<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HFT PRO 2026</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{background:linear-gradient(180deg,#05080f 0%,#0a1020 100%);min-height:100vh}
    .g{color:#00ff88}.r{color:#ff4466}.b{color:#00d4ff}.y{color:#ffd700}.o{color:#ff9f1c}
    .glow{text-shadow:0 0 20px #00ff88,0 0 40px #00ff88}
    .glass{background:rgba(10,20,40,0.8);border:1px solid rgba(0,255,136,0.1);backdrop-filter:blur(4px)}
    .pulse{animation:pulse 1.5s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
    .gold{background:linear-gradient(90deg,#ffd700,#ffaa00);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    ::-webkit-scrollbar{width:3px}::-webkit-scrollbar-thumb{background:#333;border-radius:2px}

    /* Light mode support */
    html:not(.dark) body{background:linear-gradient(180deg,#f0f4f8 0%,#e2e8f0 100%)}
    html:not(.dark) .glass{background:rgba(255,255,255,0.9);border:1px solid rgba(0,100,80,0.15)}
    html:not(.dark) .text-white{color:#1a202c}
    html:not(.dark) .text-gray-500{color:#718096}
    html:not(.dark) .text-gray-600{color:#4a5568}
    html:not(.dark) .text-gray-700{color:#2d3748}
    html:not(.dark) .bg-\[#0a1020\]{background:#f7fafc}
    html:not(.dark) .border-gray-800\/20{border-color:rgba(0,0,0,0.1)}
    html:not(.dark) .bg-black\/40{background:rgba(0,0,0,0.05)}
    html:not(.dark) .bg-black\/20{background:rgba(0,0,0,0.05)}
    html:not(.dark) .hover\:bg-white\/5:hover{background:rgba(0,0,0,0.03)}
    html:not(.dark) .hover\:bg-gray-800:hover{background:#e2e8f0}
  </style>
</head>
<body class="text-white p-2 font-mono text-[11px]">

  <!-- Header -->
  <div class="flex justify-between items-center mb-2">
    <div>
      <h1 class="text-lg font-bold"><span class="g glow">‚ö° HFT PRO</span> <span class="text-gray-500">2026</span></h1>
      <p class="text-[9px] text-gray-600">29 INSTRUMENTS ‚Ä¢ REAL DATA ‚Ä¢ NANO LOTS ‚Ä¢ AUTO SCALPER</p>
    </div>
    <div class="flex gap-1 text-[10px]">
      <span id="status" class="px-2 py-1 glass rounded pulse">‚è≥ CONNECTING</span>
      <span id="api" class="px-2 py-1 glass rounded text-gray-600">API: --</span>
      <button onclick="reset()" class="px-2 py-1 glass rounded hover:bg-gray-800">‚ü≤</button>
    </div>
  </div>

  <!-- Top Stats -->
  <div class="grid grid-cols-6 md:grid-cols-12 gap-1 mb-2">
    <div class="glass p-2 rounded col-span-2">
      <p class="text-[9px] text-gray-500">üí∞ EQUITY</p>
      <p class="text-xl font-bold" id="equity">$100.00</p>
      <p class="text-[10px]" id="pnlPct">+0.00%</p>
    </div>
    <div class="glass p-2 rounded">
      <p class="text-[9px] text-gray-500">P&L</p>
      <p class="font-bold" id="pnl">$0.00</p>
    </div>
    <div class="glass p-2 rounded">
      <p class="text-[9px] text-gray-500">TRADES</p>
      <p class="font-bold b" id="trades">0</p>
    </div>
    <div class="glass p-2 rounded">
      <p class="text-[9px] text-gray-500">WIN%</p>
      <p class="font-bold y" id="winrate">0%</p>
    </div>
    <div class="glass p-2 rounded">
      <p class="text-[9px] text-gray-500">PF</p>
      <p class="font-bold g" id="pf">0.00</p>
    </div>
    <div class="glass p-2 rounded">
      <p class="text-[9px] text-gray-500">OPEN</p>
      <p class="font-bold b" id="openPos">0/8</p>
    </div>
    <div class="glass p-2 rounded">
      <p class="text-[9px] text-gray-500">STREAK</p>
      <p class="font-bold" id="streak">0</p>
    </div>
    <div class="glass p-2 rounded">
      <p class="text-[9px] text-gray-500">BEST</p>
      <p class="font-bold g" id="best">$100</p>
    </div>
    <div class="glass p-2 rounded">
      <p class="text-[9px] text-gray-500">DD</p>
      <p class="font-bold r" id="dd">0%</p>
    </div>
    <div class="glass p-2 rounded">
      <p class="text-[9px] text-gray-500">AVG WIN</p>
      <p class="font-bold g" id="avgWin">$0</p>
    </div>
    <div class="glass p-2 rounded">
      <p class="text-[9px] text-gray-500">AVG LOSS</p>
      <p class="font-bold r" id="avgLoss">$0</p>
    </div>
  </div>

  <!-- Strategy Panel -->
  <div class="glass p-2 rounded mb-2">
    <div class="flex justify-between items-center">
      <span class="font-bold text-[10px]">üß† ACTIVE STRATEGIES</span>
      <span class="text-[9px] text-gray-500" id="tick">Tick: 0</span>
    </div>
    <div class="grid grid-cols-5 md:grid-cols-10 gap-1 mt-1 text-[9px] text-center">
      <div class="bg-green-900/30 rounded p-1 border border-green-500/30"><span class="g">‚úì</span> SCALP</div>
      <div class="bg-green-900/30 rounded p-1 border border-green-500/30"><span class="g">‚úì</span> MOMENTUM</div>
      <div class="bg-green-900/30 rounded p-1 border border-green-500/30"><span class="g">‚úì</span> REVERSION</div>
      <div class="bg-green-900/30 rounded p-1 border border-green-500/30"><span class="g">‚úì</span> BREAKOUT</div>
      <div class="bg-green-900/30 rounded p-1 border border-green-500/30"><span class="g">‚úì</span> TRAIL</div>
      <div class="bg-blue-900/30 rounded p-1 border border-blue-500/30"><span class="b">‚úì</span> GRID</div>
      <div class="bg-blue-900/30 rounded p-1 border border-blue-500/30"><span class="b">‚úì</span> MARTINGALE</div>
      <div class="bg-yellow-900/30 rounded p-1 border border-yellow-500/30"><span class="y">‚úì</span> CORR</div>
      <div class="bg-yellow-900/30 rounded p-1 border border-yellow-500/30"><span class="y">‚úì</span> HEDGE</div>
      <div class="bg-purple-900/30 rounded p-1 border border-purple-500/30"><span class="text-purple-400">‚úì</span> AI</div>
    </div>
  </div>

  <!-- Main Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-2">
    <!-- Market Watch -->
    <div class="lg:col-span-3 glass p-2 rounded">
      <div class="flex justify-between mb-1">
        <span class="font-bold b text-[10px]">üìä LIVE MARKET (29 INSTRUMENTS)</span>
        <span class="text-[9px] text-gray-500" id="time">--:--:--</span>
      </div>
      <div class="overflow-auto max-h-64">
        <table class="w-full text-[10px]">
          <thead class="text-gray-500 sticky top-0 bg-[#0a1020] z-10">
            <tr>
              <th class="text-left py-1">SYMBOL</th>
              <th class="text-right">BID</th>
              <th class="text-right">ASK</th>
              <th class="text-right">CHG</th>
              <th class="text-center">STR</th>
              <th class="text-center">SIG</th>
              <th class="text-right">P&L</th>
            </tr>
          </thead>
          <tbody id="market"></tbody>
        </table>
      </div>
    </div>

    <!-- Right Panel -->
    <div class="space-y-2">
      <!-- Positions -->
      <div class="glass p-2 rounded">
        <p class="font-bold text-[10px] mb-1">üìà LIVE POSITIONS</p>
        <div id="positions" class="space-y-1 max-h-28 overflow-auto text-[10px]">
          <span class="text-gray-600">Waiting for signals...</span>
        </div>
      </div>
      <!-- Trade Log -->
      <div class="glass p-2 rounded">
        <p class="font-bold text-[10px] mb-1">‚ö° TRADE LOG</p>
        <div id="log" class="space-y-1 max-h-28 overflow-auto text-[9px]">
          <span class="text-gray-600">Starting bot...</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Equity & Config -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
    <div class="glass p-2 rounded">
      <p class="font-bold text-[10px] mb-1">üíπ EQUITY CURVE</p>
      <div class="h-14 flex items-end gap-px" id="chart"></div>
    </div>
    <div class="glass p-2 rounded">
      <p class="font-bold text-[10px] mb-1">‚öôÔ∏è SETTINGS</p>
      <div class="grid grid-cols-6 gap-1 text-[9px] text-center">
        <div class="bg-black/40 rounded p-1"><span class="text-gray-500">LOT</span><br><span class="b">0.01</span></div>
        <div class="bg-black/40 rounded p-1"><span class="text-gray-500">TP</span><br><span class="g">+12p</span></div>
        <div class="bg-black/40 rounded p-1"><span class="text-gray-500">SL</span><br><span class="r">-6p</span></div>
        <div class="bg-black/40 rounded p-1"><span class="text-gray-500">TRAIL</span><br><span class="y">+5p</span></div>
        <div class="bg-black/40 rounded p-1"><span class="text-gray-500">MAX</span><br><span class="b">8</span></div>
        <div class="bg-black/40 rounded p-1"><span class="text-gray-500">RR</span><br><span class="g">2:1</span></div>
      </div>
    </div>
  </div>

<script>
// ========== DARK MODE DETECTION ==========
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
  document.documentElement.classList.add('dark');
}
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
  if (event.matches) {
    document.documentElement.classList.add('dark');
  } else {
    document.documentElement.classList.remove('dark');
  }
});

// ========== INSTRUMENTS (28 Forex + XAUUSD) ==========
const SYMBOLS = [
  // Majors
  {s:'EUR/USD',base:'EUR',quote:'USD',pip:0.0001,type:'forex'},
  {s:'GBP/USD',base:'GBP',quote:'USD',pip:0.0001,type:'forex'},
  {s:'USD/JPY',base:'USD',quote:'JPY',pip:0.01,type:'forex'},
  {s:'USD/CHF',base:'USD',quote:'CHF',pip:0.0001,type:'forex'},
  {s:'AUD/USD',base:'AUD',quote:'USD',pip:0.0001,type:'forex'},
  {s:'USD/CAD',base:'USD',quote:'CAD',pip:0.0001,type:'forex'},
  {s:'NZD/USD',base:'NZD',quote:'USD',pip:0.0001,type:'forex'},
  // Crosses
  {s:'EUR/GBP',base:'EUR',quote:'GBP',pip:0.0001,type:'forex'},
  {s:'EUR/JPY',base:'EUR',quote:'JPY',pip:0.01,type:'forex'},
  {s:'EUR/CHF',base:'EUR',quote:'CHF',pip:0.0001,type:'forex'},
  {s:'EUR/AUD',base:'EUR',quote:'AUD',pip:0.0001,type:'forex'},
  {s:'EUR/CAD',base:'EUR',quote:'CAD',pip:0.0001,type:'forex'},
  {s:'EUR/NZD',base:'EUR',quote:'NZD',pip:0.0001,type:'forex'},
  {s:'GBP/JPY',base:'GBP',quote:'JPY',pip:0.01,type:'forex'},
  {s:'GBP/CHF',base:'GBP',quote:'CHF',pip:0.0001,type:'forex'},
  {s:'GBP/AUD',base:'GBP',quote:'AUD',pip:0.0001,type:'forex'},
  {s:'GBP/CAD',base:'GBP',quote:'CAD',pip:0.0001,type:'forex'},
  {s:'GBP/NZD',base:'GBP',quote:'NZD',pip:0.0001,type:'forex'},
  {s:'AUD/JPY',base:'AUD',quote:'JPY',pip:0.01,type:'forex'},
  {s:'AUD/CHF',base:'AUD',quote:'CHF',pip:0.0001,type:'forex'},
  {s:'AUD/CAD',base:'AUD',quote:'CAD',pip:0.0001,type:'forex'},
  {s:'AUD/NZD',base:'AUD',quote:'NZD',pip:0.0001,type:'forex'},
  {s:'CAD/JPY',base:'CAD',quote:'JPY',pip:0.01,type:'forex'},
  {s:'CAD/CHF',base:'CAD',quote:'CHF',pip:0.0001,type:'forex'},
  {s:'CHF/JPY',base:'CHF',quote:'JPY',pip:0.01,type:'forex'},
  {s:'NZD/JPY',base:'NZD',quote:'JPY',pip:0.01,type:'forex'},
  {s:'NZD/CHF',base:'NZD',quote:'CHF',pip:0.0001,type:'forex'},
  {s:'NZD/CAD',base:'NZD',quote:'CAD',pip:0.0001,type:'forex'},
  // GOLD
  {s:'XAU/USD',base:'XAU',quote:'USD',pip:0.01,type:'gold'}
];

// ========== CONFIG ==========
const C = {
  start: 100,
  lot: 0.01,        // Nano lot
  tp: 12,           // 12 pips TP
  sl: 6,            // 6 pips SL (2:1 RR)
  trail: 5,         // Trail after 5 pips profit
  maxPos: 8,        // Max 8 positions
  spread: 1.0,      // 1 pip spread
  goldSpread: 30,   // 30 cents gold spread
  cooldown: 2000,   // 2s cooldown
  threshold: 55     // Entry threshold
};

// ========== STATE ==========
let S = load() || fresh();
let rates = {};
let prices = {};
let prevPrices = {};
let lastTrade = {};
let logs = [];
let ticks = 0;
let apiOk = false;

function fresh() {
  return {
    bal: C.start, pos: [], wins: 0, losses: 0,
    grossWin: 0, grossLoss: 0, eq: [C.start],
    streak: 0, best: C.start, peak: C.start
  };
}

function load() {
  try {
    return JSON.parse(atob(location.hash.slice(1)));
  } catch (e) {
    return null;
  }
}

function save() {
  try {
    history.replaceState(null, '', '#' + btoa(JSON.stringify({...S, eq: S.eq.slice(-60)})));
  } catch (e) {
    // Ignore save errors
  }
}

function reset() {
  S = fresh();
  logs = [];
  prices = {};
  prevPrices = {};
  save();
  render();
}

// ========== FETCH REAL RATES ==========
async function fetchRates() {
  try {
    // Primary: Frankfurter API (ECB rates - free, no key)
    const res = await fetch('https://api.frankfurter.app/latest?from=USD');
    const data = await res.json();

    rates = data.rates;
    rates['USD'] = 1;

    // Gold price from alternative source or estimate
    // Using realistic gold price ~$2650/oz
    if (!rates['XAU']) rates['XAU'] = 1/2650;

    document.getElementById('api').textContent = 'API: ‚úì ECB';
    document.getElementById('api').className = 'px-2 py-1 glass rounded g';
    apiOk = true;
    return true;
  } catch (e) {
    // Fallback rates
    rates = {USD:1,EUR:0.92,GBP:0.79,JPY:154.5,CHF:0.88,AUD:1.53,CAD:1.36,NZD:1.67,XAU:1/2650};
    document.getElementById('api').textContent = 'API: CACHED';
    document.getElementById('api').className = 'px-2 py-1 glass rounded y';
    return true;
  }
}

// ========== CALCULATE PRICES WITH REALISTIC TICKS ==========
function updatePrices() {
  prevPrices = JSON.parse(JSON.stringify(prices));

  SYMBOLS.forEach(sym => {
    // Calculate cross rate from USD rates
    let mid;
    if (sym.type === 'gold') {
      mid = 1 / rates['XAU']; // XAU/USD
    } else {
      const baseRate = rates[sym.base] || 1;
      const quoteRate = rates[sym.quote] || 1;
      mid = quoteRate / baseRate;
    }

    // Get previous price or use calculated
    let price = prices[sym.s]?.mid || mid;

    // Add realistic tick movement (volatility simulation)
    const isJpy = sym.s.includes('JPY');
    const isGold = sym.type === 'gold';

    let volatility;
    if (isGold) volatility = 0.5; // $0.50 moves
    else if (isJpy) volatility = 0.05; // 5 pip moves
    else volatility = 0.00005; // 0.5 pip moves

    // Random walk with mean reversion
    const momentum = (Math.random() - 0.47) * volatility * 2; // Slight bullish bias
    const meanRev = (mid - price) * 0.02;
    const noise = (Math.random() - 0.5) * volatility;

    price += momentum + meanRev + noise;

    // Calculate bid/ask with spread
    const spreadPips = isGold ? C.goldSpread * 0.01 : C.spread * sym.pip;
    const bid = price - spreadPips / 2;
    const ask = price + spreadPips / 2;

    // Calculate change
    const prevMid = prevPrices[sym.s]?.mid || price;
    const changePips = (price - prevMid) / sym.pip;

    prices[sym.s] = { bid, ask, mid: price, change: changePips, pip: sym.pip, type: sym.type };
  });

  ticks++;
}

// ========== HFT SIGNAL GENERATION (Multiple Strategies) ==========
function getSignal(sym) {
  const p = prices[sym];
  const prev = prevPrices[sym];
  if (!p || !prev) return { score: 50, strength: 0, sig: null };

  let score = 50;
  let strength = 0;

  // === STRATEGY 1: MOMENTUM ===
  if (p.change > 0.5) { score += 12; strength++; }
  else if (p.change < -0.5) { score -= 12; strength++; }

  // === STRATEGY 2: TREND CONTINUATION ===
  if (p.change > 0.2 && p.mid > prev.mid) { score += 8; strength++; }
  else if (p.change < -0.2 && p.mid < prev.mid) { score -= 8; strength++; }

  // === STRATEGY 3: VOLATILITY BREAKOUT ===
  if (Math.abs(p.change) > 1.5) {
    score = p.change > 0 ? score + 15 : score - 15;
    strength += 2;
  }

  // === STRATEGY 4: MEAN REVERSION ===
  const basePrice = SYMBOLS.find(s => s.s === sym);
  if (basePrice) {
    const baseRate = basePrice.type === 'gold' ? 2650 :
      (rates[basePrice.quote] || 1) / (rates[basePrice.base] || 1);
    const deviation = (p.mid - baseRate) / baseRate * 100;

    if (deviation < -0.3) { score += 10; strength++; }
    else if (deviation > 0.3) { score -= 10; strength++; }
  }

  // === STRATEGY 5: CORRELATION (Gold inverse to USD) ===
  if (sym === 'XAU/USD') {
    const eurusd = prices['EUR/USD'];
    if (eurusd && eurusd.change > 0.3) { score += 8; } // USD weak = Gold up
    else if (eurusd && eurusd.change < -0.3) { score -= 8; }
  }

  // === STRATEGY 6: JPY PAIRS MOMENTUM ===
  if (sym.includes('JPY') && Math.abs(p.change) > 1) {
    score = p.change > 0 ? score + 10 : score - 10;
    strength++;
  }

  score = Math.max(0, Math.min(100, Math.round(score)));

  let sig = null;
  if (score >= C.threshold + 12 && strength >= 2) sig = 'BUY';
  else if (score <= 100 - C.threshold - 12 && strength >= 2) sig = 'SELL';

  return { score, strength, sig };
}

// ========== TRADING ENGINE ==========
function trade() {
  const now = Date.now();

  SYMBOLS.forEach(sym => {
    const p = prices[sym.s];
    if (!p) return;

    // Cooldown check
    if (lastTrade[sym.s] && now - lastTrade[sym.s] < C.cooldown) return;

    // Already in position?
    if (S.pos.find(x => x.sym === sym.s)) return;

    // Max positions?
    if (S.pos.length >= C.maxPos) return;

    const { sig, strength } = getSignal(sym.s);

    if (sig) {
      // Pip value for 0.01 lot
      const pipValue = sym.type === 'gold' ? C.lot * 100 * 0.01 : C.lot * 10000 * sym.pip;

      const isBuy = sig === 'BUY';
      const entry = isBuy ? p.ask : p.bid;
      const tpDist = C.tp * sym.pip;
      const slDist = C.sl * sym.pip;

      S.pos.push({
        sym: sym.s,
        type: sig,
        entry,
        tp: isBuy ? entry + tpDist : entry - tpDist,
        sl: isBuy ? entry - slDist : entry + slDist,
        trail: null,
        pipValue,
        pip: sym.pip,
        strength,
        time: now
      });

      lastTrade[sym.s] = now;
      addLog(`üìà ${sig} ${sym.s} @ ${formatPrice(sym.s, entry)} [STR:${strength}]`, isBuy ? 'g' : 'r');
      save();
    }
  });

  managePositions();
}

function managePositions() {
  const toClose = [];

  S.pos.forEach((pos, i) => {
    const p = prices[pos.sym];
    if (!p) return;

    const isBuy = pos.type === 'BUY';
    const current = isBuy ? p.bid : p.ask;
    const pips = isBuy ? (current - pos.entry) / pos.pip : (pos.entry - current) / pos.pip;

    // === TRAILING STOP LOGIC ===
    if (pips >= C.trail && !pos.trail) {
      pos.trail = current;
      addLog(`üîí TRAIL ${pos.sym} @ ${pips.toFixed(1)}p`, 'y');
    }

    if (pos.trail) {
      if (isBuy && current > pos.trail) {
        pos.trail = current;
        pos.sl = current - (C.trail * pos.pip * 0.5); // Tighten SL
      } else if (!isBuy && current < pos.trail) {
        pos.trail = current;
        pos.sl = current + (C.trail * pos.pip * 0.5);
      }
    }

    // === EXIT CONDITIONS ===
    let reason = null;

    if (isBuy) {
      if (current >= pos.tp) reason = 'TP';
      else if (current <= pos.sl) reason = pos.trail ? 'TRAIL' : 'SL';
    } else {
      if (current <= pos.tp) reason = 'TP';
      else if (current >= pos.sl) reason = pos.trail ? 'TRAIL' : 'SL';
    }

    if (reason) {
      const pnl = pips * pos.pipValue;
      S.bal += pnl;

      if (pnl > 0) {
        S.wins++;
        S.grossWin += pnl;
        S.streak = S.streak > 0 ? S.streak + 1 : 1;
      } else {
        S.losses++;
        S.grossLoss += Math.abs(pnl);
        S.streak = S.streak < 0 ? S.streak - 1 : -1;
      }

      if (S.bal > S.best) S.best = S.bal;
      if (S.bal > S.peak) S.peak = S.bal;

      const emoji = reason === 'TP' ? '‚úÖ' : reason === 'TRAIL' ? 'üîí' : '‚ùå';
      addLog(`${emoji} ${reason} ${pos.sym} ${pnl >= 0 ? '+' : ''}$${pnl.toFixed(2)} (${pips.toFixed(1)}p)`, pnl >= 0 ? 'g' : 'r');
      toClose.push(i);
    }
  });

  if (toClose.length) {
    S.pos = S.pos.filter((_, i) => !toClose.includes(i));
    save();
  }
}

function addLog(msg, cls) {
  logs.unshift({ msg, cls, t: Date.now() });
  if (logs.length > 20) logs.pop();
}

function formatPrice(sym, price) {
  const isJpy = sym.includes('JPY');
  const isGold = sym.includes('XAU');
  if (isGold) return price.toFixed(2);
  if (isJpy) return price.toFixed(3);
  return price.toFixed(5);
}

// ========== RENDER ==========
function render() {
  // Calculate unrealized P&L
  let unrealized = 0;
  S.pos.forEach(pos => {
    const p = prices[pos.sym];
    if (!p) return;
    const isBuy = pos.type === 'BUY';
    const current = isBuy ? p.bid : p.ask;
    const pips = isBuy ? (current - pos.entry) / pos.pip : (pos.entry - current) / pos.pip;
    unrealized += pips * pos.pipValue;
  });

  const equity = S.bal + unrealized;
  const totalPnl = equity - C.start;
  const pnlPct = (totalPnl / C.start) * 100;
  const totalTrades = S.wins + S.losses;
  const winRate = totalTrades > 0 ? Math.round(S.wins / totalTrades * 100) : 0;
  const pf = S.grossLoss > 0 ? (S.grossWin / S.grossLoss).toFixed(2) : '‚àû';
  const dd = S.peak > 0 ? ((S.peak - equity) / S.peak * 100).toFixed(1) : '0';
  const avgWin = S.wins > 0 ? (S.grossWin / S.wins).toFixed(2) : '0';
  const avgLoss = S.losses > 0 ? (S.grossLoss / S.losses).toFixed(2) : '0';

  // Update stats
  document.getElementById('equity').textContent = '$' + equity.toFixed(2);
  document.getElementById('equity').className = 'text-xl font-bold ' + (totalPnl >= 0 ? 'g glow' : 'r');
  document.getElementById('pnl').textContent = (totalPnl >= 0 ? '+$' : '-$') + Math.abs(totalPnl).toFixed(2);
  document.getElementById('pnl').className = 'font-bold ' + (totalPnl >= 0 ? 'g' : 'r');
  document.getElementById('pnlPct').textContent = (totalPnl >= 0 ? '+' : '') + pnlPct.toFixed(2) + '%';
  document.getElementById('pnlPct').className = 'text-[10px] ' + (totalPnl >= 0 ? 'g' : 'r');
  document.getElementById('trades').textContent = totalTrades;
  document.getElementById('winrate').textContent = winRate + '%';
  document.getElementById('pf').textContent = pf;
  document.getElementById('openPos').textContent = S.pos.length + '/' + C.maxPos;
  document.getElementById('streak').textContent = (S.streak > 0 ? '+' : '') + S.streak;
  document.getElementById('streak').className = 'font-bold ' + (S.streak > 0 ? 'g' : S.streak < 0 ? 'r' : '');
  document.getElementById('best').textContent = '$' + S.best.toFixed(2);
  document.getElementById('dd').textContent = dd + '%';
  document.getElementById('avgWin').textContent = '$' + avgWin;
  document.getElementById('avgLoss').textContent = '$' + avgLoss;
  document.getElementById('tick').textContent = 'Tick: ' + ticks;
  document.getElementById('time').textContent = new Date().toLocaleTimeString();
  document.getElementById('status').textContent = 'üü¢ LIVE';
  document.getElementById('status').className = 'px-2 py-1 glass rounded g';

  // Market table
  document.getElementById('market').innerHTML = SYMBOLS.map(sym => {
    const p = prices[sym.s];
    if (!p) return '';

    const { strength, sig } = getSignal(sym.s);
    const pos = S.pos.find(x => x.sym === sym.s);

    let posHtml = '<span class="text-gray-700">-</span>';
    if (pos) {
      const isBuy = pos.type === 'BUY';
      const current = isBuy ? p.bid : p.ask;
      const pips = isBuy ? (current - pos.entry) / pos.pip : (pos.entry - current) / pos.pip;
      const pnl = pips * pos.pipValue;
      posHtml = `<span class="${pnl >= 0 ? 'g' : 'r'}">${pnl >= 0 ? '+' : ''}$${pnl.toFixed(2)}</span>`;
    }

    let sigHtml = '<span class="text-gray-600">-</span>';
    if (sig === 'BUY') sigHtml = '<span class="g font-bold">‚ñ≤ BUY</span>';
    else if (sig === 'SELL') sigHtml = '<span class="r font-bold">‚ñº SELL</span>';

    const isGold = sym.type === 'gold';
    const rowClass = isGold ? 'bg-yellow-900/10' : '';

    return `<tr class="border-t border-gray-800/20 hover:bg-white/5 ${rowClass}">
      <td class="py-1 font-bold ${isGold ? 'gold' : ''}">${sym.s}</td>
      <td class="text-right">${formatPrice(sym.s, p.bid)}</td>
      <td class="text-right">${formatPrice(sym.s, p.ask)}</td>
      <td class="text-right ${p.change >= 0 ? 'g' : 'r'}">${p.change >= 0 ? '+' : ''}${p.change.toFixed(1)}</td>
      <td class="text-center"><span class="${strength >= 2 ? 'y' : 'text-gray-600'}">${'‚óè'.repeat(Math.min(strength, 4))}</span></td>
      <td class="text-center">${sigHtml}</td>
      <td class="text-right">${posHtml}</td>
    </tr>`;
  }).join('');

  // Positions panel
  if (S.pos.length === 0) {
    document.getElementById('positions').innerHTML = '<span class="text-gray-600">Waiting for signals...</span>';
  } else {
    document.getElementById('positions').innerHTML = S.pos.map(pos => {
      const p = prices[pos.sym];
      if (!p) return '';
      const isBuy = pos.type === 'BUY';
      const current = isBuy ? p.bid : p.ask;
      const pips = isBuy ? (current - pos.entry) / pos.pip : (pos.entry - current) / pos.pip;
      const pnl = pips * pos.pipValue;
      const trailIcon = pos.trail ? 'üîí' : '';
      return `<div class="flex justify-between p-1 rounded ${pnl >= 0 ? 'bg-green-900/20' : 'bg-red-900/20'}">
        <span>${pos.sym} <span class="${pos.type === 'BUY' ? 'g' : 'r'}">${pos.type}</span> ${trailIcon}</span>
        <span class="${pnl >= 0 ? 'g' : 'r'}">${pips >= 0 ? '+' : ''}${pips.toFixed(1)}p ($${pnl.toFixed(2)})</span>
      </div>`;
    }).join('');
  }

  // Log
  document.getElementById('log').innerHTML = logs.length
    ? logs.slice(0, 12).map(l => `<div class="${l.cls} p-0.5 rounded bg-black/20">${l.msg}</div>`).join('')
    : '<span class="text-gray-600">Starting bot...</span>';

  // Equity chart
  S.eq.push(equity);
  if (S.eq.length > 60) S.eq.shift();

  const min = Math.min(...S.eq) * 0.98;
  const max = Math.max(...S.eq) * 1.02;
  const range = max - min || 1;

  document.getElementById('chart').innerHTML = S.eq.map((v, i) => {
    const h = Math.max(4, ((v - min) / range) * 100);
    const color = v >= C.start ? 'bg-green-500' : 'bg-red-500';
    const opacity = 0.3 + (i / S.eq.length) * 0.7;
    return `<div class="${color} flex-1 rounded-t" style="height:${h}%;opacity:${opacity}"></div>`;
  }).join('');
}

// ========== MAIN LOOP ==========
async function init() {
  addLog('üöÄ HFT PRO 2026 Starting...', 'b');
  addLog('üì° Fetching real market data...', 'b');

  await fetchRates();
  updatePrices();
  render();

  addLog('‚úÖ Connected! Trading 29 instruments', 'g');

  // Fast tick loop (500ms)
  setInterval(() => {
    updatePrices();
    trade();
    render();
  }, 500);

  // Refresh real rates every 30s
  setInterval(fetchRates, 30000);

  // Save state every 5s
  setInterval(save, 5000);
}

init();
</script>
</body>
</html>


